import React from 'react'
import styled, { keyframes } from 'styled-components'

import { useAllPowerOfPeaks } from 'hooks/useAppliances'

const maxPower = 4000

const warning = keyframes`
  from {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
  to {
    opacity: 1;
  }
`
const Wrapper = styled.div`
  position: absolute;
  top: 0rem;
  left: 7rem;
`
const Chart = styled.div`
  position: relative;
  animation: ${(props) => (props.angle > 180 ? warning : '')} 600ms infinite;
`
const Gauge = styled.svg`
  width: 8rem;
  height: auto;
`
const Hand = styled.svg`
  position: absolute;
  bottom: 1.5rem;
  right: 50%;
  transform: rotate(${(props) => (props.angle > 180 ? 180 : props.angle)}deg);
  transform-origin: right;
  width: 3.5rem;
  transition: transform 300ms ease-in-out;

  path {
    fill: ${(props) => props.theme.colors.text};
  }
`
export default function Score() {
  const power = useAllPowerOfPeaks()

  const angle = (power / maxPower) * 180

  return (
    <Wrapper>
      <Chart angle={angle}>
        <Hand
          width='214'
          height='34'
          viewBox='0 0 214 34'
          fill='none'
          xmlns='http://www.w3.org/2000/svg'
          angle={angle}
        >
          <path d='M-7.43094e-07 17L196.96 -8.6094e-06L196.96 34L-7.43094e-07 17Z' />
          <path d='M197.461 -8.6313e-06C206.595 -9.03057e-06 214 7.61115 214 17C214 26.3888 206.595 34 197.461 34C188.327 34 180.922 26.3888 180.922 17C180.922 7.61115 188.327 -8.23204e-06 197.461 -8.6313e-06Z' />
        </Hand>

        <Gauge
          width='647'
          height='567'
          viewBox='0 0 647 567'
          fill='none'
          xmlns='http://www.w3.org/2000/svg'
        >
          <mask
            id='mask0_892_4815'
            style={{ 'mask-type': 'alpha' }}
            maskUnits='userSpaceOnUse'
            x='0'
            y='0'
            width='647'
            height='487'
          >
            <path d='M552.565 406.092C565.825 369.316 570.036 329.888 564.84 291.141C559.645 252.394 545.197 215.468 522.718 183.483C500.238 151.499 470.388 125.398 435.691 107.386C400.994 89.3735 362.47 79.9802 323.377 80C284.283 80.0198 245.769 89.4521 211.09 107.499C176.411 125.547 146.588 151.678 124.141 183.685C101.694 215.692 87.283 252.633 82.127 291.386C76.9711 330.138 81.2215 369.562 94.5188 406.324L95.4019 406.005C82.1558 369.384 77.9218 330.112 83.0579 291.509C88.1939 252.907 102.549 216.108 124.91 184.225C147.27 152.341 176.979 126.31 211.524 108.332C246.069 90.3547 284.434 80.9588 323.377 80.9391C362.32 80.9193 400.695 90.2763 435.258 108.219C469.822 126.162 499.556 152.163 521.949 184.023C544.342 215.884 558.734 252.668 563.91 291.266C569.085 329.863 564.891 369.14 551.682 405.774L552.565 406.092Z' />
            <path
              d='M552.565 406.092C565.825 369.316 570.036 329.888 564.84 291.141C559.645 252.394 545.197 215.468 522.718 183.483C500.238 151.499 470.388 125.398 435.691 107.386C400.994 89.3735 362.47 79.9802 323.377 80C284.283 80.0198 245.769 89.4521 211.09 107.499C176.411 125.547 146.588 151.678 124.141 183.685C101.694 215.692 87.283 252.633 82.127 291.386C76.9711 330.138 81.2215 369.562 94.5188 406.324L95.4019 406.005C82.1558 369.384 77.9218 330.112 83.0579 291.509C88.1939 252.907 102.549 216.108 124.91 184.225C147.27 152.341 176.979 126.31 211.524 108.332C246.069 90.3547 284.434 80.9588 323.377 80.9391C362.32 80.9193 400.695 90.2763 435.258 108.219C469.822 126.162 499.556 152.163 521.949 184.023C544.342 215.884 558.734 252.668 563.91 291.266C569.085 329.863 564.891 369.14 551.682 405.774L552.565 406.092Z'
              fill='#D9D9D9'
            />
            <path
              d='M552.565 406.092C565.825 369.316 570.036 329.888 564.84 291.141C559.645 252.394 545.197 215.468 522.718 183.483C500.238 151.499 470.388 125.398 435.691 107.386C400.994 89.3735 362.47 79.9802 323.377 80C284.283 80.0198 245.769 89.4521 211.09 107.499C176.411 125.547 146.588 151.678 124.141 183.685C101.694 215.692 87.283 252.633 82.127 291.386C76.9711 330.138 81.2215 369.562 94.5188 406.324L95.4019 406.005C82.1558 369.384 77.9218 330.112 83.0579 291.509C88.1939 252.907 102.549 216.108 124.91 184.225C147.27 152.341 176.979 126.31 211.524 108.332C246.069 90.3547 284.434 80.9588 323.377 80.9391C362.32 80.9193 400.695 90.2763 435.258 108.219C469.822 126.162 499.556 152.163 521.949 184.023C544.342 215.884 558.734 252.668 563.91 291.266C569.085 329.863 564.891 369.14 551.682 405.774L552.565 406.092Z'
              stroke='black'
              fill='black'
              stroke-width='160'
              stroke-linejoin='round'
              mask='url(#path-1-outside-1_892_4815)'
            />
          </mask>
          <g mask='url(#mask0_892_4815)'>
            <path
              d='M584.541 546.771C627.325 496.75 654.836 435.49 663.8 370.281C672.764 305.072 662.804 238.66 635.105 178.95C607.406 119.239 563.134 68.7444 507.559 33.4747C451.983 -1.79506 387.445 -20.3545 321.623 -19.9948C255.802 -19.6352 191.47 -0.371597 136.283 35.5033C81.0967 71.3783 37.3795 122.354 10.3346 182.363C-16.7104 242.373 -25.9442 308.889 -16.2679 373.997C-6.59161 439.104 21.5872 500.06 64.9151 549.611L323.5 323.5L584.541 546.771Z'
              fill='#476C9B'
            />
            <path
              d='M584.541 546.771C619.33 506.097 644.133 457.856 656.971 405.897C669.81 353.937 670.329 299.696 658.487 247.5C646.645 195.304 622.77 146.597 588.765 105.265C554.761 63.9323 511.568 31.118 462.633 9.439C413.697 -12.24 360.373 -22.1838 306.913 -19.5992C253.453 -17.0147 201.336 -1.97337 154.72 24.3251C108.104 50.6235 68.2789 87.4513 38.4202 131.871C8.56151 176.291 -10.504 227.073 -17.2558 280.168L323.5 323.5L584.541 546.771Z'
              fill='#6768AD'
            />
            <path
              d='M584.541 546.771C641.647 480.005 671 393.894 666.562 306.149C662.124 218.403 624.233 135.694 560.681 75.0297C497.129 14.3656 412.749 -19.6412 324.892 -19.9971C237.035 -20.3531 152.381 12.969 88.3402 73.1162L323.5 323.5L584.541 546.771Z'
              fill='#965BAF'
            />
            <path
              d='M584.541 546.771C627.168 496.933 654.638 435.933 663.703 370.98C672.768 306.028 663.05 239.838 635.697 180.232C608.344 120.627 564.499 70.0977 509.345 34.6158C454.19 -0.866161 390.031 -19.8175 324.449 -19.9987L323.5 323.5L584.541 546.771Z'
              fill='#C5449C'
            />
            <path
              d='M584.541 546.771C641.464 480.219 670.818 394.438 666.602 306.964C662.386 219.491 624.919 136.93 561.86 76.1605L323.5 323.5L584.541 546.771Z'
              fill='#EA2577'
            />
            <path
              d='M584.541 546.771C615.529 510.541 638.636 468.257 652.391 422.61C666.147 376.963 670.25 328.953 664.439 281.633L323.5 323.5L584.541 546.771Z'
              fill='#FA1E43'
            />
          </g>
        </Gauge>
      </Chart>
    </Wrapper>
  )
}
